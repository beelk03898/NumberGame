{\rtf1\ansi\ansicpg949\cocoartf2867
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fnil\fcharset0 HelveticaNeue;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\deftab560
\pard\pardeftab560\slleading20\pardirnatural\partightenfactor0

\f0\fs26 \cf0 <!DOCTYPE html>\
<html lang="ko">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">\
    <title>ZERO SUM - Soft Glass & Ranking</title>\
    <style>\
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Noto+Sans+KR:wght@400;700&display=swap');\
\
        * \{ touch-action: manipulation; -webkit-tap-highlight-color: transparent; \}\
        body \{ margin: 0; background: #000; color: white; font-family: 'Noto Sans KR', sans-serif; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; width: 100vw; \}\
        \
        /* \uc0\u54868 \u47732  \u53356 \u44592 \u50640  \u47582 \u44172  \u51088 \u46041  \u51312 \u51208 \u46104 \u45716  \u52968 \u53580 \u51060 \u45320  */\
        #game-outer \{ position: relative; width: 100%; height: 100%; max-width: 500px; background: #0f0f0f; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,1); transition: background 0.3s; \}\
\
        .layer \{ position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: all 0.5s ease-in-out; \}\
\
        #logo-screen \{ background: #000; z-index: 3000; pointer-events: none; \}\
        .logo-text \{ font-family: 'Orbitron', sans-serif; font-size: 3rem; font-weight: 900; color: #00ffcc; opacity: 0; animation: logo-fade 2.5s forwards; \}\
\
        #home-screen \{ background: radial-gradient(circle, #1a1a1a, #000); z-index: 2000; opacity: 0; pointer-events: none; \}\
        #home-screen.active \{ opacity: 1; pointer-events: auto; \}\
        .game-title \{ font-family: 'Orbitron', sans-serif; font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 20px rgba(0,255,204,0.3); margin-bottom: 5px; \}\
        \
        .nickname-input \{ background: rgba(255,255,255,0.1); border: 1px solid #00ffcc; border-radius: 5px; color: #fff; padding: 12px; text-align: center; font-family: 'Orbitron'; margin-bottom: 20px; outline: none; width: 220px; font-size: 1rem; \}\
\
        #billboard \{ width: 80%; max-width: 300px; background: rgba(255,255,255,0.05); border: 1px solid #333; border-radius: 10px; padding: 15px; margin-bottom: 30px; cursor: pointer; transition: 0.3s; \}\
        #billboard:hover \{ background: rgba(255,255,255,0.1); border-color: #00ffcc; \}\
        .ranking-title \{ font-family: 'Orbitron'; font-size: 1rem; color: #00ffcc; margin-bottom: 10px; text-align: center; border-bottom: 1px solid #333; padding-bottom: 5px; \}\
        .ranking-list \{ list-style: none; padding: 0; margin: 0; font-family: 'Orbitron'; font-size: 0.9rem; \}\
        .ranking-item \{ display: flex; justify-content: space-between; padding: 3px 0; color: #ccc; \}\
        .ranking-item.top \{ color: #ffd700; font-weight: bold; \}\
\
        #rank-popup \{ position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; \}\
        #rank-popup.active \{ opacity: 1; pointer-events: auto; \}\
        .rank-box \{ background: #111; border: 2px solid #00ffcc; width: 85%; max-height: 70%; border-radius: 20px; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; \}\
        .full-rank-list \{ list-style: none; padding: 0; width: 100%; \}\
        .full-rank-item \{ display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #222; font-family: 'Orbitron'; color: #eee; \}\
\
        .btn-group \{ display: flex; flex-direction: column; gap: 10px; width: 220px; \}\
        .main-btn \{ padding: 15px; font-size: 1.1rem; cursor: pointer; background: transparent; border: 2px solid #00ffcc; color: #00ffcc; border-radius: 50px; font-weight: bold; transition: 0.3s; font-family: 'Orbitron', sans-serif; outline: none; \}\
        .main-btn:active \{ background: #00ffcc; color: #000; \}\
\
        #howto-popup \{ position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 4000; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; text-align: center; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; \}\
        #howto-popup.active \{ opacity: 1; pointer-events: auto; \}\
        .howto-box \{ background: #222; border: 2px solid #00ffcc; padding: 40px 30px; border-radius: 20px; width: 80%; \}\
        .howto-box p \{ font-size: 1.1rem; line-height: 1.8; color: #fff; margin-bottom: 30px; word-break: keep-all; \}\
\
        #game-ui \{ position: absolute; top: 0; width: 100%; height: 85px; background: rgba(40, 40, 40, 0.8); backdrop-filter: blur(10px); display: flex; flex-direction: column; justify-content: center; z-index: 1500; transform: translateY(-100%); transition: 0.5s; padding: 5px 20px; box-sizing: border-box; border-bottom: 1px solid rgba(255,255,255,0.1); \}\
        #game-ui.active \{ transform: translateY(0); \}\
        \
        .ui-top \{ display: flex; justify-content: space-between; align-items: center; width: 100%; margin-bottom: 8px; \}\
        #fever-bar-container \{ width: 100%; height: 10px; background: #111; border-radius: 5px; overflow: hidden; border: 1px solid #444; \}\
        #fever-bar \{ width: 0%; height: 100%; background: linear-gradient(90deg, #ff99ff, #99ffff); transition: width 0.1s linear; \}\
\
        #game-container \{ position: relative; width: 100%; height: 100%; background: transparent; overflow: hidden; \}\
        \
        .pause-btn-group \{ display: flex; gap: 8px; align-items: center; \}\
        .pause-btn-style \{ cursor: pointer; background: none; border: 1px solid #777; color: #fff; border-radius: 4px; padding: 4px 8px; font-family: 'Orbitron'; font-size: 0.7rem; \}\
        #home-btn \{ display: none; border-color: #ff4444; color: #ff4444; \}\
\
        .ball \{ \
            position: absolute; width: 56px; height: 56px; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 900; cursor: pointer; user-select: none; font-size: 1.2rem; z-index: 5; box-sizing: border-box; transition: transform 0.1s;\
            backdrop-filter: blur(4px); border: 1px solid rgba(255, 255, 255, 0.4);\
            box-shadow: inset -5px -5px 12px rgba(0,0,0,0.2), inset 5px 5px 12px rgba(255,255,255,0.4), 0 8px 15px rgba(0,0,0,0.3);\
            color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.3);\
        \}\
        .ball.selected \{ transform: scale(1.2); z-index: 100 !important; box-shadow: 0 0 25px rgba(255,255,255,0.6), inset 0 0 10px rgba(255,255,255,0.5); border: 3px solid #fff; \}\
        .melting \{ transition: transform 0.6s cubic-bezier(0.55, 0.055, 0.675, 0.19), opacity 0.5s ease !important; transform: translateY(60px) scaleY(0.1) scaleX(1.3) !important; opacity: 0 !important; pointer-events: none !important; \}\
        \
        .dead-line \{ position: absolute; bottom: 0; width: 100%; height: 15px; background: linear-gradient(to top, rgba(255, 68, 68, 0.5), transparent); z-index: 10; \}\
\
        @keyframes logo-fade \{ 0% \{ opacity: 0; transform: scale(0.8); \} 40%, 70% \{ opacity: 1; transform: scale(1); \} 100% \{ opacity: 0; transform: scale(1.1); \} \}\
        .fever-active \{ animation: fever-bg 0.5s infinite alternate !important; \}\
        @keyframes fever-bg \{ from \{ background: #0f0f0f; \} to \{ background: #1a0f1a; \} \}\
        .warning-flash \{ animation: bg-flash 0.5s infinite alternate; \}\
        @keyframes bg-flash \{ from \{ background: #0f0f0f; \} to \{ background: #2a1515; \} \}\
    </style>\
</head>\
<body>\
\
<div id="game-outer">\
    <div id="logo-screen" class="layer"><div class="logo-text">ZERO SUM</div></div>\
    \
    <div id="home-screen" class="layer">\
        <div class="game-title">ZERO SUM</div>\
        \
        <div id="billboard" onclick="showRankPopup(true)">\
            <div class="ranking-title">GLOBAL RANKING</div>\
            <ul class="ranking-list" id="rank-list"></ul>\
            <div style="font-size:0.6rem; text-align:center; margin-top:5px; opacity:0.5;">CLICK TO VIEW ALL</div>\
        </div>\
\
        <input type="text" id="player-name" class="nickname-input" placeholder="ENTER NICKNAME" maxlength="10">\
\
        <div class="btn-group">\
            <button class="main-btn" onclick="goToGame()">START GAME</button>\
            <button class="main-btn" onclick="showHowTo(true)">HOW TO</button>\
        </div>\
    </div>\
\
    <div id="rank-popup">\
        <div class="rank-box">\
            <div class="ranking-title" style="font-size:1.5rem; margin-bottom:20px;">RANKING HALL</div>\
            <ul class="full-rank-list" id="full-rank-list"></ul>\
        </div>\
        <button class="main-btn" style="width:120px; margin-top:20px;" onclick="showRankPopup(false)">CLOSE</button>\
    </div>\
\
    <div id="howto-popup">\
        <div class="howto-box">\
            <p>\uc0\u54633 \u51012  0\u51004 \u47196  \u47564 \u46300 \u49464 \u50836 .<br>\u48148 \u45797 \u50640  \u45823 \u51004 \u47732  \u45149 \u45225 \u45768 \u45796 .</p>\
            <center><button class="main-btn" style="width:120px; padding:10px;" onclick="showHowTo(false)">OK</button></center>\
        </div>\
    </div>\
\
    <div id="game-ui">\
        <div class="ui-top">\
            <div style="font-family:'Orbitron'; font-size: 0.9rem;">SC: <span id="score">0</span></div>\
            <div id="sum-display" style="font-family:'Orbitron'; font-size: 1rem; font-weight: bold;">SUM: 0</div>\
            <div class="pause-btn-group">\
                <button id="home-btn" onclick="quitToHome()" class="pause-btn-style">HOME</button>\
                <button id="pauseBtn" onclick="togglePause()" class="pause-btn-style">PAUSE</button>\
            </div>\
        </div>\
        <div id="fever-bar-container"><div id="fever-bar"></div></div>\
    </div>\
    <div id="game-container"><div class="dead-line"></div></div>\
</div>\
\
<script>\
    const screens = \{ \
        outer: document.getElementById('game-outer'),\
        logo: document.getElementById('logo-screen'), \
        home: document.getElementById('home-screen'), \
        ui: document.getElementById('game-ui'), \
        howto: document.getElementById('howto-popup'),\
        rankList: document.getElementById('rank-list'),\
        fullRankList: document.getElementById('full-rank-list'),\
        rankPopup: document.getElementById('rank-popup'),\
        nameInput: document.getElementById('player-name')\
    \};\
    const scoreEl = document.getElementById('score'), sumEl = document.getElementById('sum-display'), \
          container = document.getElementById('game-container'), feverBar = document.getElementById('fever-bar');\
    \
    let score = 0, selectedBalls = [], balls = [], gameActive = false, isPaused = false;\
    let baseSpeed = 0.3, spawnRate = 1600, lastSpawn = 0, combo = 0, lastPopTime = 0;\
    let isFrozen = false, isFoggy = false, freezeTimer = null, fogTimer = null;\
    let feverGauge = 0, isFever = false, feverEndTime = 0;\
    \
    const FEVER_MAX = 100, FEVER_DURATION = 5000, BALL_SIZE = 56, COMBO_TIMEOUT = 3000;\
    let deadLineY = 0;\
\
    window.addEventListener('resize', () => \{ deadLineY = container.clientHeight - 15; \});\
    deadLineY = container.clientHeight || 750 - 15;\
\
    let playerName = localStorage.getItem('zeroSumNick') || "";\
    screens.nameInput.value = playerName;\
    updateBillboard();\
\
    setTimeout(() => \{ screens.logo.style.display = 'none'; screens.home.classList.add('active'); \}, 2500);\
\
    function showHowTo(on) \{ if(on) \{ screens.howto.classList.add('active'); \} else \{ screens.howto.classList.remove('active'); \} \}\
\
    function showRankPopup(on) \{\
        if(on) \{\
            const ranks = cleanAndGetRanks();\
            screens.fullRankList.innerHTML = ranks.length ? "" : "<li style='text-align:center; padding:20px; opacity:0.5;'>NO DATA</li>";\
            ranks.forEach((data, idx) => \{\
                const li = document.createElement('li');\
                li.className = 'full-rank-item';\
                li.innerHTML = `<span>$\{idx + 1\}. $\{data.name\}</span> <span>$\{data.score\}</span>`;\
                if(idx < 3) li.style.color = idx === 0 ? '#ffd700' : (idx === 1 ? '#c0c0c0' : '#cd7f32');\
                screens.fullRankList.appendChild(li);\
            \});\
            screens.rankPopup.classList.add('active');\
        \} else \{ screens.rankPopup.classList.remove('active'); \}\
    \}\
    \
    function goToGame() \{ \
        playerName = screens.nameInput.value.trim() || "Player";\
        localStorage.setItem('zeroSumNick', playerName);\
        screens.home.classList.remove('active'); \
        screens.ui.classList.add('active'); \
        deadLineY = container.clientHeight - 15;\
        if (audioCtx.state === 'suspended') audioCtx.resume(); \
        resetGame(); \
        gameActive = true; \
        requestAnimationFrame(update); \
    \}\
\
    function cleanAndGetRanks() \{\
        let rawRanks = JSON.parse(localStorage.getItem('zeroSumRanks')) || [];\
        let cleanedMap = new Map();\
        rawRanks.forEach(r => \{\
            const nameKey = r.name.trim();\
            if (!cleanedMap.has(nameKey) || r.score > cleanedMap.get(nameKey)) \{ cleanedMap.set(nameKey, r.score); \}\
        \});\
        let cleanedRanks = Array.from(cleanedMap, ([name, score]) => (\{ name, score \}));\
        cleanedRanks.sort((a, b) => b.score - a.score);\
        localStorage.setItem('zeroSumRanks', JSON.stringify(cleanedRanks));\
        return cleanedRanks;\
    \}\
\
    function updateBillboard() \{\
        const ranks = cleanAndGetRanks();\
        screens.rankList.innerHTML = ranks.length ? "" : "<li style='text-align:center; opacity:0.5;'>NO DATA</li>";\
        ranks.slice(0, 3).forEach((data, idx) => \{\
            const li = document.createElement('li');\
            li.className = `ranking-item $\{idx === 0 ? 'top' : ''\}`;\
            li.innerHTML = `<span>$\{idx + 1\}. $\{data.name\}</span> <span>$\{data.score\}</span>`;\
            screens.rankList.appendChild(li);\
        \});\
    \}\
\
    function saveScore(finalScore) \{\
        if (finalScore <= 0) return;\
        let ranks = JSON.parse(localStorage.getItem('zeroSumRanks')) || [];\
        ranks.push(\{ name: playerName, score: finalScore \});\
        localStorage.setItem('zeroSumRanks', JSON.stringify(ranks));\
        updateBillboard();\
    \}\
\
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();\
    function playSound(freq, type, duration) \{\
        if (audioCtx.state === 'suspended') return;\
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();\
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);\
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);\
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);\
        osc.connect(gain); gain.connect(audioCtx.destination);\
        osc.start(); osc.stop(audioCtx.currentTime + duration);\
    \}\
\
    function createParticle(x, y, color) \{\
        for (let i = 0; i < 6; i++) \{\
            const p = document.createElement('div');\
            p.style.cssText = `position:absolute; width:6px; height:6px; border-radius:50%; background:$\{color\}; pointer-events:none; z-index:100; left:$\{x\}px; top:$\{y\}px;`;\
            container.appendChild(p);\
            const angle = Math.random() * Math.PI * 2, velocity = 2 + Math.random() * 3;\
            let px = x, py = y, vx = Math.cos(angle) * velocity, vy = Math.sin(angle) * velocity, op = 1;\
            const pAnim = () => \{\
                px += vx; py += vy; op -= 0.03;\
                p.style.left = px + 'px'; p.style.top = py + 'px'; p.style.opacity = op;\
                if (op > 0) requestAnimationFrame(pAnim); else p.remove();\
            \};\
            requestAnimationFrame(pAnim);\
        \}\
    \}\
\
    function getRandomValue() \{\
        const range = Math.min(15, 7 + Math.floor(score / 3000));\
        let val = Math.floor(Math.random() * (range * 2 + 1)) - range;\
        return val === 0 ? getRandomValue() : val;\
    \}\
\
    function createBall() \{\
        let type = 'normal', val, isLucky = false;\
        const rand = Math.random();\
        if (rand < 0.015) type = 'gold';\
        else if (rand < 0.03) type = 'bomb';\
        else if (rand < 0.045) type = 'freeze';\
        else if (rand < 0.07) type = 'heavy';\
        else if (rand < 0.1) type = 'fog';\
        \
        if (type === 'normal' || type === 'heavy') \{\
            if (Math.random() < 0.07) isLucky = true; \
            val = getRandomValue();\
        \} else \{ val = type === 'gold' ? '\uc0\u9733 ' : (type === 'bomb' ? 'B' : (type === 'freeze' ? 'F' : '?')); \}\
\
        const ball = document.createElement('div'); \
        ball.className = `ball $\{type\} $\{isLucky ? 'lucky' : ''\}`; \
        let cv = (isFever && (type === 'normal' || type === 'heavy')) ? (val > 0 ? 1 : -1) : val;\
\
        const ballObj = \{ \
            el: ball, val: cv, originalVal: val, type: type, isLucky: isLucky, \
            x: Math.random() * (container.clientWidth - BALL_SIZE), y: -60, vx: (Math.random()-0.5)*0.5, \
            speed: (baseSpeed + (score / 5000)) * (type === 'heavy' ? 1.6 : 1.0) + Math.random()*0.3, isMelting: false \
        \};\
        \
        updateBallText(ball, ballObj.val, type);\
        setBallColor(ball, ballObj.val, type, isLucky);\
        container.appendChild(ball); balls.push(ballObj);\
        ball.addEventListener('touchstart', (e) => \{ e.preventDefault(); if(!ballObj.isMelting) toggleSelect(ballObj); \});\
        ball.addEventListener('mousedown', (e) => \{ if(!ballObj.isMelting) toggleSelect(ballObj); \});\
    \}\
\
    function setBallColor(el, val, type, isLucky) \{\
        if (type === 'normal' || type === 'heavy') \{\
            if (isLucky) el.style.background = "radial-gradient(circle at 30% 30%, #fff5b4, #daa520)";\
            else if (val > 0) el.style.background = "radial-gradient(circle at 30% 30%, #ffb4be, #ff6478)";\
            else el.style.background = "radial-gradient(circle at 30% 30%, #b4d2ff, #6496ff)";\
        \} else if (type === 'gold') el.style.background = "radial-gradient(circle at 30% 30%, #fff5b4, #ffd700)";\
        else if (type === 'bomb') el.style.background = "radial-gradient(circle at 30% 30%, #646464, #141414)";\
        else if (type === 'freeze') el.style.background = "radial-gradient(circle at 30% 30%, #c8ffff, #00dfff)";\
        else if (type === 'fog') el.style.background = "radial-gradient(circle at 30% 30%, #969696, #323232)";\
    \}\
\
    function updateBallText(el, val, type) \{\
        if (isFoggy && (type === 'normal' || type === 'heavy')) el.innerText = '?';\
        else el.innerText = typeof val === 'number' ? (val > 0 ? `+$\{val\}` : val) : val;\
    \}\
\
    function toggleSelect(ballObj) \{\
        if (!gameActive || isPaused) return;\
        if (ballObj.type === 'gold') \{ activateGold(ballObj); return; \}\
        if (ballObj.type === 'bomb') \{ activateBomb(ballObj); return; \}\
        if (ballObj.type === 'freeze') \{ activateFreeze(ballObj); return; \}\
        if (ballObj.type === 'fog') \{ activateFog(ballObj); return; \}\
\
        if (selectedBalls.includes(ballObj)) \{ selectedBalls = selectedBalls.filter(b => b !== ballObj); ballObj.el.classList.remove('selected'); playSound(300, 'sine', 0.1); \}\
        else \{ selectedBalls.push(ballObj); ballObj.el.classList.add('selected'); playSound(600, 'sine', 0.1); \}\
        updateSumDisplay();\
    \}\
\
    function updateSumDisplay() \{\
        const sum = selectedBalls.reduce((s, b) => s + b.val, 0);\
        sumEl.innerText = `SUM: $\{selectedBalls.length === 0 ? 0 : sum\}`;\
        sumEl.style.color = selectedBalls.length > 0 ? (sum === 0 ? "#00ffcc" : (sum > 0 ? "#ffb4be" : "#b4d2ff")) : "#00ffcc";\
        if (selectedBalls.length > 0 && sum === 0) popBalls();\
    \}\
\
    function popBalls(isGold = false) \{\
        const now = Date.now();\
        if (now - lastPopTime < COMBO_TIMEOUT) combo++; else combo = 1;\
        lastPopTime = now;\
        if (!isGold) \{\
            let hasLucky = selectedBalls.some(b => b.isLucky);\
            score += (selectedBalls.length * 10) * combo * (hasLucky ? 5 : 1);\
            if (!isFever) \{\
                feverGauge = Math.min(FEVER_MAX, feverGauge + selectedBalls.length * 5);\
                feverBar.style.width = feverGauge + '%';\
                if (feverGauge >= FEVER_MAX) startFever();\
            \}\
            selectedBalls.forEach(b => \{\
                createParticle(b.x + BALL_SIZE/2, b.y + BALL_SIZE/2, b.isLucky ? '#ffd700' : (b.val > 0 ? '#ffb4be' : '#b4d2ff'));\
                b.el.remove(); balls = balls.filter(allB => allB !== b);\
            \});\
            selectedBalls = []; \
        \} else \{ score += (selectedBalls.length + 1) * 20; \}\
        scoreEl.innerText = score;\
        updateSumDisplay();\
    \}\
\
    function startFever() \{\
        isFever = true; feverEndTime = Date.now() + FEVER_DURATION;\
        screens.outer.classList.add('fever-active'); playSound(1200, 'square', 0.5);\
        balls.forEach(b => \{ if (!b.isMelting && (b.type === 'normal' || b.type === 'heavy')) \{ b.val = b.val > 0 ? 1 : -1; updateBallText(b.el, b.val, b.type); setBallColor(b.el, b.val, b.type, b.isLucky); \} \});\
        updateSumDisplay();\
    \}\
\
    function endFever() \{\
        isFever = false; feverGauge = 0; feverBar.style.width = '0%';\
        screens.outer.classList.remove('fever-active');\
        balls.forEach(b => \{ if (!b.isMelting && (b.type === 'normal' || b.type === 'heavy')) \{ b.val = b.originalVal; updateBallText(b.el, b.val, b.type); setBallColor(b.el, b.val, b.type, b.isLucky); \} \});\
        selectedBalls = []; updateSumDisplay();\
    \}\
\
    function activateGold(ballObj) \{\
        playSound(800, 'square', 0.2); createParticle(ballObj.x + BALL_SIZE/2, ballObj.y + BALL_SIZE/2, '#ffd700');\
        ballObj.el.remove(); balls = balls.filter(b => b !== ballObj);\
        selectedBalls.forEach(b => \{ createParticle(b.x + BALL_SIZE/2, b.y + BALL_SIZE/2, b.val > 0 ? '#ffb4be' : '#b4d2ff'); b.el.remove(); balls = balls.filter(allB => allB !== b); \});\
        popBalls(true); selectedBalls = [];\
    \}\
\
    function activateBomb(ballObj) \{\
        playSound(200, 'sawtooth', 0.3); createParticle(ballObj.x + BALL_SIZE/2, ballObj.y + BALL_SIZE/2, '#ff6b6b');\
        ballObj.el.remove(); balls = balls.filter(b => b !== ballObj);\
        for(let i = 0; i < 3; i++) \{\
            if(balls.length > 0) \{\
                const target = balls[Math.floor(Math.random() * balls.length)];\
                createParticle(target.x + BALL_SIZE/2, target.y + BALL_SIZE/2, '#ff6b6b');\
                target.el.remove(); balls = balls.filter(b => b !== target);\
                selectedBalls = selectedBalls.filter(b => b !== target);\
            \}\
        \}\
        score += 50; scoreEl.innerText = score; updateSumDisplay();\
    \}\
\
    function activateFreeze() \{ isFrozen = true; if (freezeTimer) clearTimeout(freezeTimer); freezeTimer = setTimeout(() => isFrozen = false, 5000); \}\
    function activateFog() \{ isFoggy = true; balls.forEach(b => updateBallText(b.el, b.val, b.type)); if(fogTimer) clearTimeout(fogTimer); fogTimer = setTimeout(() => \{ isFoggy = false; balls.forEach(b => updateBallText(b.el, b.val, b.type)); \}, 3000); \}\
\
    function update(time) \{\
        if (!gameActive || isPaused) return;\
        if (isFever) \{ let rem = feverEndTime - Date.now(); feverGauge = (rem / FEVER_DURATION) * 100; feverBar.style.width = feverGauge + '%'; if (rem <= 0) endFever(); \}\
        if (time - lastSpawn > (isFever ? spawnRate/2 : spawnRate)) \{ createBall(); lastSpawn = time; \}\
        \
        let warning = false;\
        for (let i = balls.length - 1; i >= 0; i--) \{\
            let b1 = balls[i]; if (b1.isMelting) continue;\
            b1.y += isFrozen ? b1.speed * 0.2 : b1.speed; b1.x += b1.vx;\
            if (b1.x < 0 || b1.x > container.clientWidth - BALL_SIZE) b1.vx *= -1;\
            b1.el.style.transform = `translate($\{b1.x\}px, $\{b1.y\}px)`;\
            if (b1.y >= deadLineY - BALL_SIZE) \{\
                b1.isMelting = true; b1.el.classList.add('melting');\
                if (b1.type === 'normal' || b1.type === 'heavy') \{ gameActive = false; setTimeout(gameOver, 600); return; \}\
                else \{ setTimeout(() => \{ b1.el.remove(); balls = balls.filter(b => b !== b1); \}, 600); \}\
            \}\
            if (b1.y > deadLineY - 150) warning = true;\
        \}\
        if (warning) screens.outer.classList.add('warning-flash'); else screens.outer.classList.remove('warning-flash');\
        requestAnimationFrame(update);\
    \}\
\
    function togglePause() \{\
        isPaused = !isPaused;\
        document.getElementById('pauseBtn').innerText = isPaused ? "RESUME" : "PAUSE";\
        document.getElementById('home-btn').style.display = isPaused ? "block" : "none";\
        if (!isPaused) requestAnimationFrame(update);\
    \}\
\
    function quitToHome() \{ isPaused = false; gameOver(); \}\
    function gameOver() \{ \
        gameActive = false; screens.outer.classList.remove('warning-flash', 'fever-active');\
        saveScore(score); screens.ui.classList.remove('active');\
        setTimeout(() => \{ screens.home.classList.add('active'); balls.forEach(b => b.el.remove()); balls = []; \}, 500);\
    \}\
    function resetGame() \{ balls.forEach(b => b.el.remove()); balls = []; selectedBalls = []; score = 0; scoreEl.innerText = '0'; feverGauge = 0; isFever = false; updateSumDisplay(); \}\
</script>\
</body>\
</html>}